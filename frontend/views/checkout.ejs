<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <link rel="icon" href="/image/Logo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.2.0/remixicon.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- link icon -->
    <link rel="stylesheet" data-purpose="Layout StyleSheet" title="Web Awesome"
        href="/css/app-wa-8d95b745961f6b33ab3aa1b98a45291a.css?vsn=d">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.0/css/all.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.0/css/sharp-solid.css">
    <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.0/css/sharp-regular.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+3:200,300,regular,500,
            600,700,800,900,200italic,300italic,italic,500italic,600italic,700italic,800italic,900italic" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ionicons@5.5.2/dist/ionicons.css">

    <!-- css -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://cdn.jsdelivr.net/npm/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <link href="/css/checkout.css" rel="stylesheet">

</head>

<body>
    <% cartProduct=typeof cartProduct !=='undefined' ? cartProduct : []; %>
    <% total = typeof total !=='undefined' ? total : []; %>
    <% user = typeof user !=='undefined' ? user : []; %>
    <% message = typeof message !=='undefined' ? message : []; %>

    <!--header-->
    <nav class="navbar navbar-expand-sm navbar-header container-fluid"
        style="z-index: 1050; position: relative;">
        <a class="navbar-brand" href="#" style="font-weight: 700; font-size: 50px; color: #7c4c2c;">
            <img src="/image/Logo.png" alt="logo" style="width: 90px;">
            GELADO
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/product">Product</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/cart">Cart</a>
                </li>
                <li class="nav-item">
                    <div class="dropdown dropleft" style="float: left;">
                        <button type="button" class="btn-account dropdown-toggle" data-toggle="dropdown">
                            <i class="fa-sharp fa-solid fa-circle-user fa-2xl"></i>
                        </button>
                        <div class="dropdown-menu">
                          <a class="dropdown-item" href="/account">Account</a>
                          <a class="dropdown-item" href="/orderHistory">Order History</a>
                          <a class="dropdown-item" href="/orderTracking">Order Tracking</a>
                        </div>
                    </div>                    
                </li>
            </ul>
        </div>
    </nav>


    <div class="container">
        <h1 class="heading">Shopping Cart</h1>
        <div class="item">
            <div class="checkout">
                <!-- Shipping Information Details -->
                <h2 class="section-heading">Shipping Details</h2>
                <div class="payment-form">
                    <form id="checkoutForm" method="post" action="/checkout/pay">
                        <!-- Email -->
                        <div class="form-group">
                            <label for="email" class="label">Email</label>
                            <input type="email" id="email" name="email" required placeholder="Enter your email"
                                class="form-input" value="<%= user ? user.email : '' %>">
                        </div>
                        <!-- Username -->
                        <div class="form-group">
                            <label for="username" class="label">Username</label>
                            <input type="text" id="username" name="username" required placeholder="Enter your username"
                                class="form-input" value="<%= user ? user.username : '' %>">
                        </div>
                        <!-- Phone -->
                        <div class="form-group">
                            <label for="phone" class="label">Phone</label>
                            <input type="tel" id="phone" name="phone" required placeholder="Enter your phone" 
                                class="form-input" value="<%= phone %>">
                        </div>
                        <!-- Address -->
                        <div class="form-group">
                            <label for="address" class="label">Address</label>
                            <input type="text" id="address" name="address" required placeholder="Enter your address" 
                                class="form-input" value="<%= address %>">
                        </div>

                        <div class="wrapper">
                            <div class="amount">
                            
    
                                <div class="total">
                                    <span>Total</span>
                                    <span>
                                        <%= total %> 
                                    </span>
                                </div>
                                
                            </div>
                        </div>

                        <!-- Submit button -->
                        <button type="submit" class="btn btn-pay"><b>PAY</b></button>
                    </form>
                    
                    <% if (message) { %>
                        <div class="alert">
                            <p><%= message %></p>
                        </div>
                    <% } %>
            </div>
        </div>

    </div>

    <script>
        'use strict';
        const decrementBtn = document.querySelectorAll('#decrement');
        const quantityElem = document.querySelectorAll('#quantity');
        const incrementBtn = document.querySelectorAll('#increment');
        const priceElem = document.querySelectorAll('#price');
        const subtotalElem = document.querySelector('#subtotal');
        const taxElem = document.querySelector('#tax');
        const totalElem = document.querySelector('#total');
        $(document).ready(function () {
            // Khi click vào Credit Card hoặc Cash on Delivery
            $('.payment-method .method').click(function () {
                // Kiểm tra nếu chọn "Credit Card"
                if ($(this).find('span').text() === 'Credit Card') {
                    // Hiển thị form thông tin thẻ tín dụng
                    $('#credit-card-info').show();
                } else if ($(this).find('span').text() === 'Cash on Delivery') {
                    // Ẩn form thông tin thẻ tín dụng
                    $('#credit-card-info').hide();
                }
                // Loại bỏ class "fill" khỏi tất cả các icon
                $('.payment-method .checkmark').removeClass('fill').attr('name', 'checkmark-circle-outline');
                // Thêm class "fill" vào icon của button đã được click
                $(this).find('.checkmark').addClass('fill').attr('name', 'checkmark-circle');
            });
        });





        // add event on multiple increment & decrement button
        for (let i = 0; i < incrementBtn.length; i++) {
            incrementBtn[i].addEventListener('click', function () {
                let increment = Number(this.previousElementSibling.textContent);
                increment++;
                this.previousElementSibling.textContent = increment;
                totalCalc();
            });
            decrementBtn[i].addEventListener('click', function () {
                let decrement = Number(this.nextElementSibling.textContent);
                decrement <= 1 ? 1 : decrement--;
                this.nextElementSibling.textContent = decrement;
                totalCalc();
            });
        }
        // alculating total amount of product price
        const totalCalc = function () {
            const tax = 0.05;
            let subtotal = 0;
            let totalTax = 0;
            let total = 0;
            for (let i = 0; i < quantityElem.length; i++) {
                subtotal += Number(quantityElem[i].textContent) * Number(priceElem[i].textContent);
            }
            subtotalElem.textContent = subtotal.toFixed(2);
            totalTax = subtotal * tax;
            taxElem.textContent = totalTax.toFixed(2);
            // calculate  `total`
            total = subtotal + totalTax;
            totalElem.textContent = total.toFixed(2);
        }
        document.querySelector(".btnSubmit").addEventListener("click", function () {
            const productComments = [];
            document.querySelectorAll(".product-item").forEach((item, index) => {
                const productName = item.querySelector("h5").innerText;
                const comment = item.querySelector("textarea").value;
                productComments.push({ product: productName, comment: comment });
            });
            console.log(productComments);
            fetch('/submit_comments', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(productComments)
            }).then(response => response.json())
                .then(data => {
                    alert("Comments submitted successfully!");
                }).catch(error => {
                    alert("Error submitting comments");
                });
        });
        document.querySelector(".btn-pay").addEventListener("click", function () {
            // Hiển thị modal
            
        });


    </script>

    <!--script for notification for user-->
    <script>
        $(document).ready(function () {
            // Khi click vào Credit Card hoặc Cash on Delivery
            $('.payment-method .method').click(function () {
                // Kiểm tra nếu chọn "Credit Card"
                if ($(this).find('span').text() === 'Credit Card') {
                    // Hiển thị form thông tin thẻ tín dụng
                    $('#credit-card-info').show();
                } else if ($(this).find('span').text() === 'Cash on Delivery') {
                    // Ẩn form thông tin thẻ tín dụng
                    $('#credit-card-info').hide();
                }
                // Loại bỏ class "fill" khỏi tất cả các icon
                $('.payment-method .checkmark').removeClass('fill').attr('name', 'checkmark-circle-outline');
                // Thêm class "fill" vào icon của button đã được click
                $(this).find('.checkmark').addClass('fill').attr('name', 'checkmark-circle');
            });
            
        });
    </script>

</body>

</html>